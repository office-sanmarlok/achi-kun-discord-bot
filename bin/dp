#!/usr/bin/env bash
#
# dp - Discord Postコマンド
# 使い方:
#   dp <session_number> "message"   # セッション番号を指定してメッセージ送信
#

# Get toolkit root directory (resolve symlinks)
SCRIPT_PATH="$(readlink -f "$0")"
TOOLKIT_ROOT="$(cd "$(dirname "$SCRIPT_PATH")/.." && pwd)"

# Check arguments
if [ $# -ne 2 ]; then
    echo "Usage: dp <session_number> \"message\""
    echo "Example: dp 1 \"Hello from Claude Code\""
    exit 1
fi

SESSION="$1"
MESSAGE="$2"

# Validate session number
if ! [[ "$SESSION" =~ ^[0-9]+$ ]] || [ "$SESSION" -lt 1 ] || [ "$SESSION" -gt 999 ]; then
    echo "Error: Session number must be a number between 1 and 999"
    exit 1
fi

# Send message
# Use printf to avoid bash interpreting special characters
printf '%s\n' "$MESSAGE" | python3 "$TOOLKIT_ROOT/src/discord_post.py" "$SESSION"