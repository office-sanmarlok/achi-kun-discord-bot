# Requirements Document

## Introduction

この機能は、Discord内で`!`プレフィックスを使用したコマンドシステムを実装します。主な目的は以下の2点です：
1. `!`で始まるメッセージがClaude Code（CC）に転送されないようにフィルタリングする
2. スレッド内で`!post`コマンドを実行すると、そのスレッド名を事前に設定された別のチャンネルに自動送信する

これにより、Discord Bot内でCCへの通常のプロンプトとは独立したコマンドシステムを構築し、スレッド情報の他チャンネルへの通知機能を提供します。

## Requirements

### Requirement 1: プレフィックスメッセージのフィルタリング

**User Story:** Discord利用者として、`!`で始まるメッセージをBotコマンドとして使用したいが、これらがClaude Codeに転送されないようにしたい

#### Acceptance Criteria

1. WHEN ユーザーが`!`で始まるメッセージをチャンネルに送信 THEN システム SHALL そのメッセージをClaude Codeへ転送しない
2. WHEN ユーザーが`!`で始まるメッセージをスレッド内で送信 THEN システム SHALL そのメッセージをClaude Codeへ転送しない
3. IF メッセージが`!`で始まらない THEN システム SHALL 通常通りメッセージを処理する
4. WHEN `!`プレフィックスのメッセージが処理される THEN システム SHALL 既存の`!status`、`!sessions`、`!cc`コマンドの動作を維持する
5. IF 未知の`!`コマンドが入力された AND スレッド外で実行された THEN システム SHALL エラーメッセージや無視などの適切な処理を行う

### Requirement 2: スレッド名送信コマンド

**User Story:** Discord利用者として、スレッド内で特定のコマンドを実行することで、そのスレッド名を別のチャンネルに通知したい

#### Acceptance Criteria

1. WHEN ユーザーがスレッド内で`!post`コマンドを実行 THEN システム SHALL そのスレッド名を設定されたチャンネルに送信する
2. IF `!post`コマンドがスレッド外で実行された THEN システム SHALL 「このコマンドはスレッド内でのみ使用可能です」というエラーメッセージを返す
3. IF 送信先チャンネルが設定されていない THEN システム SHALL 「送信先チャンネルが設定されていません」というエラーメッセージを返す
4. WHEN スレッド名が正常に送信された THEN システム SHALL スレッド内に「スレッド名を{チャンネル名}に送信しました」という確認メッセージを投稿する
5. IF 送信先チャンネルへのアクセス権限がない THEN システム SHALL 「送信先チャンネルへのアクセス権限がありません」というエラーメッセージを返す
6. WHEN 送信先チャンネルにメッセージが投稿される THEN システム SHALL 「スレッド名: {スレッド名}」という形式でメッセージを送信する
7. IF 送信先チャンネルが削除されている、または存在しない THEN システム SHALL 「送信先チャンネルが見つかりません」というエラーメッセージを返す

### Requirement 3: 設定管理

**User Story:** システム管理者として、送信先チャンネルを設定・変更したい

#### Acceptance Criteria

1. WHEN 管理者が送信先チャンネルIDを設定 THEN システム SHALL その設定を永続的に保存する
2. IF 設定ファイルに送信先チャンネルIDが存在する THEN システム SHALL 起動時にその設定を読み込む
3. WHEN 送信先チャンネルIDが変更された THEN システム SHALL 新しい設定を即座に反映する
4. IF 無効なチャンネルIDが設定された THEN システム SHALL 設定を拒否しエラーメッセージを返す